\section{Link detection}
\label{sec:link-detection}

The link detection is the task of discovering \textit{hidden links} in a network. 
A link $(x,y)$ is hidden if it exists in reality, but it is missing within the available datasets, because it has been neglected during investigations or it has been concealed by criminals.

We present here the \textit{Traffic Allocation (TA)} metric, that is a local metric specifically thought for link detection in criminal networks 
The metric is based on the following criminological assumptions: 

\begin{enumerate}
	\item two criminal nodes hide their direct relation interposing some nodes between them, namely \textit{mediator nodes}; formally, a direct link $(x,y)$ can be hidden by a path $\pi=(x,z_{1},\ldots,z_{h},y)$, where $z_{1},\ldots,z_{h}$ are broker nodes;
	
	\item the broker nodes are mainly dedicated to let them interact; formally, the total interaction weight $w_{z_{i}}$ involving a mediator node $z_{i}$ is mainly dedicated to convey the hidden interaction between $(x,y)$;
	
	\item the greater the number of these nodes, the greater the likelihood of hidden linkage. 
\end{enumerate}

Let us now consider an undirected weighted graph $G(V,E,w)$ with $w:E\rightarrow\mathbb{R}_{\geq1}^{+}$ and a pair of nodes $x,y\in V$.
We can build the following local metric, leveraging the previous assumptions:

\begin{equation}
\label{eqn:ta-local}
\Phi(x,y)=
\sum\limits_{z\in\Gamma(x)\cap\Gamma(y)}
\frac{(w_{x,z}+w_{z,y})}{w_{z}}
\end{equation}

where 
$\Gamma(x,y)$ is the set of common neighbours between $x$ and $y$,
$w_{x,z}$ is the weight of the edge $(x,z)$ and
$w_{z}$ is the total weight of the edges incident to $z$.

The previous metric can be extended to its notmralized version, namely \textit{Normal Traffic Allocation (NTA)}:

\begin{equation}
\label{eqn:nta-local}
\Phi(x,y)=
\frac{\sum\limits_{z\in\Gamma(x)\cap\Gamma(y)}\frac{(w_{x,z}+w_{z,y})}{w_{z}}}
{\sum\limits_{z\in\Gamma(x)\cap\Gamma(y)}w_{z}}
\end{equation}

The last metric produces a normalized score $\Phi(x,y)\in(0,1)$, hence it is suitable for thresholding.
Given an arbitrary threshold $\tilde{\Phi}$, every edge $(x,y)$ such that $\Phi(x,y)\geq\tilde{\Phi}$ is considered an hidden link with a probability proportional to the score achieved.
Since $\Phi$ is strictly related to the edge weights, the threshold must be chosen according to the maximum and minimum weights observed on the graph. 

%The Equation~\ref{eqn:nta-local} can be extended to the following quasi-local metric. Let us now consider an undirected weighted graph $G$ with $w:E\rightarrow\mathbb{R}_{\geq1}^{+}$, a pair of nodes $x,y\in V$, a locality degree $t\in \mathbb{Z}$, $t\geq 1$, and a vector $\vec{\mu}=(\mu_{1}\ldots\mu_{t})$ such that $\sum_{i=1}^{t}\mu{i}=1$.
%We can build the following quasi-local metric:

%\begin{equation}
%\label{eqn:detection-quasi-local-1}
%\Phi_{QL}(x,y,t,\vec{\mu})=\vec{\mu}\cdot\vec{\Phi}_{QL}(x,y,t)
%\end{equation}

%where $\vec{\Phi}_{QL}(x,y,t)=(\Phi_{QL}(x,y,1)\ldots\Phi_{QL}(x,y,t))$ is a vector of scores with every element defined as follows:
%\begin{equation}
%\label{eqn:detection-quasi-local-2}
%\Phi_{QL}(x,y,i)=
%\frac{\sum\limits_{\pi\in\Pi_{x,y}^{(i+1)}}w_{\pi}}
%{\sum\limits_{z\in\pi\in\Pi_{x,y}^{(i+1)}}w_{z}}
%\end{equation}

%where $\Pi_{x,y}^{(i)}$ is the set of paths between $x$ and $y$ of length $i$,
%$w_{\pi}$ is the weight of path $\pi$ and
%$w_{z}$ is the total weight of edges incident to $z$.

%The metric produces a normalized score $\Phi_{QL}(x,y,t,\vec{\mu})\in(0,1)$, hence holds here he same considerations about thresholding stated for the local metric.